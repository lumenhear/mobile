/* RechargeTree Prototype (React)

What this file contains:

A single-file React component (default export) that implements a working prototype of the ₹5 Recharge + Binary Referral site logic using browser localStorage.

No real payment gateway is integrated — recharges are simulated for demo purposes.


How to run (quick):

1. Create a new React app (e.g., using create-react-app). npx create-react-app recharge-tree


2. Install Tailwind CSS (optional) or keep the classes — you can use the provided simple styles or substitute your own. For quick testing you can remove Tailwind classes and rely on basic CSS.


3. Replace src/App.jsx with the contents of this file (rename to App.jsx if needed).


4. Start the dev server: npm start.



Notes:

Data persists in localStorage under keys: rt_users and rt_currentUserId.

Default commission rules (modifiable in code):

Direct sponsor (level 1) gets ₹1 when their referral recharges ₹5.

Level 2 sponsor gets ₹0.5.


New user placement: auto-alternate between left and right under sponsor (binary placement per sponsor).

The prototype includes a basic "Admin" view (login as admin with email admin@rt.local and password admin123) to view all users and transactions.


This is a prototype — use as a base for production implementation, add proper backend, DB, payment gateway, security and legal checks before launching. */

import React, { useEffect, useState } from 'react';

// Helper utilities const LOCAL_USERS_KEY = 'rt_users'; const LOCAL_CURRENT_KEY = 'rt_currentUserId'; const LOCAL_TXN_KEY = 'rt_txns';

function uid(prefix = 'u') { return prefix + Math.random().toString(36).slice(2, 9); }

// Bootstrapped admin user function bootstrapIfEmpty() { const raw = localStorage.getItem(LOCAL_USERS_KEY); if (!raw) { const admin = { id: 'admin', name: 'Admin', email: 'admin@rt.local', phone: '', password: 'admin123', sponsorId: null, left: null, right: null, wallet: 0, placedOnSide: null, createdAt: new Date().toISOString(), }; localStorage.setItem(LOCAL_USERS_KEY, JSON.stringify([admin])); localStorage.setItem(LOCAL_TXN_KEY, JSON.stringify([])); } }

function readUsers() { const raw = localStorage.getItem(LOCAL_USERS_KEY) || '[]'; try { return JSON.parse(raw); } catch (e) { return []; } } function writeUsers(users) { localStorage.setItem(LOCAL_USERS_KEY, JSON.stringify(users)); }

function readTxns() { return JSON.parse(localStorage.getItem(LOCAL_TXN_KEY) || '[]'); } function writeTxns(txns) { localStorage.setItem(LOCAL_TXN_KEY, JSON.stringify(txns)); }

// Commission configuration (edit as needed) const CONFIG = { rechargeAmount: 5, directCommission: 1.0, // level 1 level2Commission: 0.5, // level 2 };

export default function RechargeTreePrototype() { bootstrapIfEmpty();

const [users, setUsers] = useState(readUsers()); const [currentUserId, setCurrentUserId] = useState(localStorage.getItem(LOCAL_CURRENT_KEY) || null); const [txns, setTxns] = useState(readTxns());

const [view, setView] = useState('dashboard'); // login/register/dashboard/admin

// Forms const [regName, setRegName] = useState(''); const [regEmail, setRegEmail] = useState(''); const [regPhone, setRegPhone] = useState(''); const [regPassword, setRegPassword] = useState(''); const [regReferral, setRegReferral] = useState('');

const [loginEmail, setLoginEmail] = useState(''); const [loginPassword, setLoginPassword] = useState('');

useEffect(() => { setUsers(readUsers()); setTxns(readTxns()); }, []);

useEffect(() => { writeUsers(users); }, [users]);

useEffect(() => { writeTxns(txns); }, [txns]);

function findUserByEmail(email) { return users.find(u => u.email === email); }

function findUserById(id) { return users.find(u => u.id === id); }

// Auto-placement: place alternately on left/right for the sponsor function placeNewUserUnderSponsor(sponsorId, newUser) { const all = [...users]; const sponsor = all.find(u => u.id === sponsorId) || null; if (!sponsor) return null;

// if left empty -> place left
if (!sponsor.left) {
  sponsor.left = newUser.id;
  newUser.placedOnSide = 'left';
  newUser.sponsorId = sponsor.id;
} else if (!sponsor.right) {
  sponsor.right = newUser.id;
  newUser.placedOnSide = 'right';
  newUser.sponsorId = sponsor.id;
} else {
  // both filled - find a node to place under using simple BFS to keep tree balanced
  const queue = [sponsor.left, sponsor.right];
  while (queue.length > 0) {
    const candidateId = queue.shift();
    const candidate = all.find(u => u.id === candidateId);
    if (!candidate) continue;
    if (!candidate.left) {
      candidate.left = newUser.id;
      newUser.placedOnSide = 'left';
      newUser.sponsorId = candidate.id;
      break;
    }
    if (!candidate.right) {
      candidate.right = newUser.id;
      newUser.placedOnSide = 'right';
      newUser.sponsorId = candidate.id;
      break;
    }
    if (candidate.left) queue.push(candidate.left);
    if (candidate.right) queue.push(candidate.right);
  }
}

// persist sponsor changes
setUsers(all);
return newUser.sponsorId;

}

function handleRegister(e) { e && e.preventDefault(); if (!regEmail || !regPassword) { alert('Enter email and password'); return; }

if (findUserByEmail(regEmail)) {
  alert('User already exists with that email');
  return;
}

const newUser = {
  id: uid('u'),
  name: regName || regEmail.split('@')[0],
  email: regEmail,
  phone: regPhone,
  password: regPassword,
  sponsorId: null,
  left: null,
  right: null,
  wallet: 0,
  placedOnSide: null,
  createdAt: new Date().toISOString(),
};

// default placement if referral provided
const all = [...users, newUser];
setUsers(all);

if (regReferral) {
  const sponsor = users.find(u => u.id === regReferral || u.email === regReferral);
  if (sponsor) {
    placeNewUserUnderSponsor(sponsor.id, newUser);
  } else {
    // treat as placed under admin
    placeNewUserUnderSponsor('admin', newUser);
  }
} else {
  // if no referral, place under admin by default
  placeNewUserUnderSponsor('admin', newUser);
}

// auto-login
localStorage.setItem(LOCAL_CURRENT_KEY, newUser.id);
setCurrentUserId(newUser.id);
setView('dashboard');

// clear form
setRegName('');
setRegEmail('');
setRegPhone('');
setRegPassword('');
setRegReferral('');

}

function handleLogin(e) { e && e.preventDefault(); const user = findUserByEmail(loginEmail); if (!user) { alert('No user found'); return; } if (user.password !== loginPassword) { alert('Incorrect password'); return; } localStorage.setItem(LOCAL_CURRENT_KEY, user.id); setCurrentUserId(user.id); setView(user.id === 'admin' ? 'admin' : 'dashboard'); setLoginEmail(''); setLoginPassword(''); }

function handleLogout() { localStorage.removeItem(LOCAL_CURRENT_KEY); setCurrentUserId(null); setView('login'); }

// Commission processing when recharge happens function processRecharge(payerId, amount = CONFIG.rechargeAmount) { const all = [...users]; const payer = all.find(u => u.id === payerId); if (!payer) { alert('Payer not found'); return; }

// Simulate successful recharge
const txn = {
  id: uid('t'),
  userId: payer.id,
  amount,
  type: 'recharge',
  createdAt: new Date().toISOString(),
};

const newTxns = [txn, ...txns];
setTxns(newTxns);

// Pay commissions up the tree
// Level 1
if (payer.sponsorId) {
  const sponsor = all.find(u => u.id === payer.sponsorId);
  if (sponsor) {
    sponsor.wallet = Number((sponsor.wallet + CONFIG.directCommission).toFixed(2));
    newTxns.unshift({ id: uid('t'), userId: sponsor.id, amount: CONFIG.directCommission, type: 'commission_level1', from: payer.id, createdAt: new Date().toISOString() });

    // Level 2
    if (sponsor.sponsorId) {
      const lvl2 = all.find(u => u.id === sponsor.sponsorId);
      if (lvl2) {
        lvl2.wallet = Number((lvl2.wallet + CONFIG.level2Commission).toFixed(2));
        newTxns.unshift({ id: uid('t'), userId: lvl2.id, amount: CONFIG.level2Commission, type: 'commission_level2', from: payer.id, createdAt: new Date().toISOString() });
      }
    }
  }
}

// persist updates
setUsers(all);
setTxns(newTxns);

}

function handleRechargeClick() { if (!currentUserId) { alert('Please log in'); return; } // In a real app, integrate Razorpay / other payment gateway here. if (!window.confirm(Proceed to recharge ₹${CONFIG.rechargeAmount} (simulated)?)) return; processRecharge(currentUserId, CONFIG.rechargeAmount); alert('Recharge successful (simulated). Commissions credited to uplines.'); }

function withdraw(amount) { const all = [...users]; const me = all.find(u => u.id === currentUserId); if (!me) return; if (amount <= 0 || amount > me.wallet) { alert('Invalid withdraw amount'); return; }

me.wallet = Number((me.wallet - amount).toFixed(2));
setUsers(all);
const wtx = { id: uid('t'), userId: me.id, amount: -amount, type: 'withdraw', createdAt: new Date().toISOString() };
setTxns([wtx, ...txns]);
alert('Withdraw request simulated. In production, trigger payout via UPI / bank.');

}

// UI helpers const currentUser = currentUserId ? findUserById(currentUserId) : null;

function countSubtree(userId) { if (!userId) return { left: 0, right: 0, total: 0 }; const u = findUserById(userId); if (!u) return { left: 0, right: 0, total: 0 }; function dfs(id) { const node = findUserById(id); if (!node) return 0; let c = 1; if (node.left) c += dfs(node.left); if (node.right) c += dfs(node.right); return c; } const left = u.left ? dfs(u.left) : 0; const right = u.right ? dfs(u.right) : 0; return { left, right, total: left + right }; }

function renderTree(userId, depth = 0) { const u = findUserById(userId); if (!u) return null; return ( <div className="pl-2 border-l ml-2 mt-2"> <div className="text-sm font-medium">{u.name} <span className="text-xs text-gray-500">({u.email})</span></div> <div className="text-xs text-gray-600">Wallet: ₹{u.wallet.toFixed(2)}</div> <div className="flex mt-1 gap-2"> {u.left ? <div className="w-1/2">{renderTree(u.left, depth+1)}</div> : <div className="w-1/2 text-xs italic text-gray-400">left empty</div>} {u.right ? <div className="w-1/2">{renderTree(u.right, depth+1)}</div> : <div className="w-1/2 text-xs italic text-gray-400">right empty</div>} </div> </div> ); }

// Basic layout return ( <div className="min-h-screen bg-gray-50 p-4"> <div className="max-w-5xl mx-auto bg-white shadow rounded p-6"> <header className="flex items-center justify-between mb-6"> <div> <h1 className="text-2xl font-bold">RechargeTree (Prototype)</h1> <div className="text-sm text-gray-600">₹{CONFIG.rechargeAmount} prepaid recharge + binary referral demo</div> </div> <div className="flex items-center gap-4"> {currentUser ? ( <> <div className="text-sm">Hi, <strong>{currentUser.name}</strong></div> <button className="px-3 py-1 bg-red-500 text-white rounded" onClick={handleLogout}>Logout</button> </> ) : ( <> <button className="px-3 py-1 bg-blue-600 text-white rounded" onClick={() => setView('login')}>Login</button> <button className="px-3 py-1 border rounded" onClick={() => setView('register')}>Register</button> </> )} </div> </header>

{/* Views */}
    {view === 'login' && (
      <div>
        <h2 className="text-xl font-semibold mb-3">Login</h2>
        <form onSubmit={handleLogin} className="space-y-3 max-w-md">
          <input className="w-full p-2 border rounded" placeholder="Email" value={loginEmail} onChange={e => setLoginEmail(e.target.value)} />
          <input type="password" className="w-full p-2 border rounded" placeholder="Password" value={loginPassword} onChange={e => setLoginPassword(e.target.value)} />
          <div className="flex gap-2">
            <button type="submit" className="px-4 py-2 bg-blue-600 text-white rounded">Login</button>
            <button type="button" className="px-4 py-2 border rounded" onClick={() => setView('register')}>Go to Register</button>
          </div>
        </form>
      </div>
    )}

    {view === 'register' && (
      <div>
        <h2 className="text-xl font-semibold mb-3">Register</h2>
        <form onSubmit={handleRegister} className="grid grid-cols-1 gap-3 max-w-md">
          <input className="w-full p-2 border rounded" placeholder="Name" value={regName} onChange={e => setRegName(e.target.value)} />
          <input className="w-full p-2 border rounded" placeholder="Email" value={regEmail} onChange={e => setRegEmail(e.target.value)} />
          <input className="w-full p-2 border rounded" placeholder="Phone (optional)" value={regPhone} onChange={e => setRegPhone(e.target.value)} />
          <input type="password" className="w-full p-2 border rounded" placeholder="Password" value={regPassword} onChange={e => setRegPassword(e.target.value)} />
          <input className="w-full p-2 border rounded" placeholder="Referral (sponsor id or email)" value={regReferral} onChange={e => setRegReferral(e.target.value)} />
          <div className="flex gap-2">
            <button className="px-4 py-2 bg-green-600 text-white rounded" type="submit">Register & Login</button>
            <button className="px-4 py-2 border rounded" type="button" onClick={() => setView('login')}>Go to Login</button>
          </div>
        </form>
      </div>
    )}

    {view === 'dashboard' && currentUser && currentUser.id === 'admin' && (
      <div>
        <h2 className="text-lg font-semibold mb-3">Admin Dashboard</h2>
        <div className="grid grid-cols-3 gap-4">
          <div className="p-3 border rounded">
            <div className="text-sm text-gray-500">Total Users</div>
            <div className="text-2xl font-bold">{users.length}</div>
          </div>
          <div className="p-3 border rounded">
            <div className="text-sm text-gray-500">Total Transactions</div>
            <div className="text-2xl font-bold">{txns.length}</div>
          </div>
          <div className="p-3 border rounded">
            <div className="text-sm text-gray-500">Sample Recharge Amount</div>
            <div className="text-2xl font-bold">₹{CONFIG.rechargeAmount}</div>
          </div>
        </div>

        <div className="mt-4">
          <h3 className="font-semibold">All Users</h3>
          <div className="max-h-64 overflow-auto mt-2 border rounded p-2">
            {users.map(u => (
              <div key={u.id} className="p-2 border-b last:border-b-0">
                <div className="flex justify-between items-center">
                  <div>
                    <div className="font-medium">{u.name} <span className="text-xs ml-2 text-gray-500">{u.email}</span></div>
                    <div className="text-sm text-gray-600">Sponsor: {u.sponsorId || '-'} | Left: {u.left || '-'} | Right: {u.right || '-'}</div>
                  </div>
                  <div>Wallet: ₹{u.wallet.toFixed(2)}</div>
                </div>
              </div>
            ))}
          </div>
        </div>

        <div className="mt-4">
          <h3 className="font-semibold">Transactions (latest)</h3>
          <div className="max-h-48 overflow-auto mt-2 border rounded p-2">
            {txns.map(t => (
              <div key={t.id} className="p-2 border-b last:border-b-0 text-sm">
                <div>{t.type} | User: {t.userId} | Amount: ₹{t.amount} | {new Date(t.createdAt).toLocaleString()}</div>
              </div>
            ))}
          </div>
        </div>
      </div>
    )}

    {view === 'dashboard' && currentUser && currentUser.id !== 'admin' && (
      <div>
        <div className="grid grid-cols-3 gap-4 mb-4">
          <div className="p-3 border rounded">
            <div className="text-sm text-gray-500">Left Members</div>
            <div className="text-2xl font-bold">{countSubtree(currentUser.id).left}</div>
          </div>
          <div className="p-3 border rounded">
            <div className="text-sm text-gray-500">Right Members</div>
            <div className="text-2xl font-bold">{countSubtree(currentUser.id).right}</div>
          </div>
          <div className="p-3 border rounded">
            <div className="text-sm text-gray-500">Wallet Balance</div>
            <div className="text-2xl font-bold">₹{currentUser.wallet.toFixed(2)}</div>
          </div>
        </div>

        <div className="flex gap-4 mb-4">
          <div>
            <button className="px-4 py-2 bg-indigo-600 text-white rounded" onClick={handleRechargeClick}>Recharge ₹{CONFIG.rechargeAmount}</button>
          </div>
          <div>
            <button className="px-4 py-2 border rounded" onClick={() => { const amt = prompt('Enter withdraw amount'); if (amt) withdraw(Number(amt)); }}>Withdraw</button>
          </div>
          <div>
            <button className="px-4 py-2 border rounded" onClick={() => { navigator.clipboard && currentUser && navigator.clipboard.writeText(currentUser.id); alert('Referral code copied to clipboard (user id)'); }}>Copy Referral Code</button>
          </div>
        </div>

        <div className="grid grid-cols-2 gap-4">
          <div className="p-3 border rounded">
            <h3 className="font-semibold mb-2">My Network</h3>
            <div className="text-sm text-gray-600 mb-2">Sponsor: {currentUser.sponsorId || '-'}</div>
            <div className="text-sm text-gray-500">Binary Tree (visual)</div>
            <div className="mt-2">
              {renderTree(currentUser.id)}
            </div>
          </div>

          <div className="p-3 border rounded">
            <h3 className="font-semibold mb-2">Referral & Earnings</h3>
            <div className="text-sm text-gray-600 mb-2">Share this referral id: <span className="font-mono">{currentUser.id}</span></div>
            <div className="text-sm text-gray-600 mb-2">Invite link (demo): <span className="text-indigo-600">/register?ref={currentUser.id}</span></div>
            <div className="mt-2">
              <h4 className="font-medium">Recent Transactions</h4>
              <div className="max-h-56 overflow-auto mt-2">
                {txns.filter(t => t.userId === currentUser.id || t.type.startsWith('commission')).slice(0,30).map(t => (
                  <div key={t.id} className="text-sm border-b p-2">
                    <div>{t.type} | ₹{t.amount} | {new Date(t.createdAt).toLocaleString()}</div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>

      </div>
    )}

    {/* If no current user and not in login/register view, show intro */}
    {!currentUser && view === 'dashboard' && (
      <div className="text-center py-10">
        <h2 className="text-xl font-semibold">Welcome to RechargeTree Prototype</h2>
        <p className="text-gray-600 mt-2">Register to start recharging ₹{CONFIG.rechargeAmount} and earn referral commissions.</p>
        <div className="mt-4">
          <button className="px-4 py-2 bg-blue-600 text-white rounded" onClick={() => setView('register')}>Register Now</button>
        </div>
      </div>
    )}

  </div>
</div>

); }

